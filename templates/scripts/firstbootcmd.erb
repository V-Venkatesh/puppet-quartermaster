@echo on 

@powershell -NoProfile -Command "$newnameset = $false; (gwmi Win32_NetworkAdapterConfiguration | ? { $_.IPAddress -ne $null }).ipaddress | ? {$_ -match '([\d]+\.){3}([\d]+)'} | % {if (-not $newnameset -and ($lu = (nslookup $_ 2>null | findstr /i 'name:')) -ne $null) { if ($lu.SubString(5) -match '([^\s.]+)(\.[^\s.]*)*') {$newnameset = $true; (Get-WmiObject Win32_ComputerSystem)Rename($matches[1]);} } }"
@powershell -NoProfile -ExecutionPolicy unrestricted -Command "iex ((new-object net.webclient).DownloadString('https://chocolatey.org/install.ps1'))" && SET PATH=%PATH%;%systemdrive%\chocolatey\bin || pause
c:\Chocolatey\bin\cinst -force puppet
c:\Chocolatey\bin\cinst -force git
c:\Program Files (x86)\Puppet Labs\puppet\puppet.bat agent --debug --trace --verbose --test --waitforcert 60 --server <%= @fqdn %> 
